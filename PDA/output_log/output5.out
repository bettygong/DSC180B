/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
*** Current working path ***
/home/zgong/PDA
time slot unique in train: [6 7 5 8 0 3 2 4 1]
                                                   uid                                               time
iid                                                                                                      
0    [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,...  [6, 7, 7, 6, 6, 5, 7, 6, 7, 6, 5, 7, 5, 6, 5, ...
1    [1270, 1271, 1272, 1273, 1274, 1275, 1276, 127...  [8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, ...
12442388 833866 1942172
n_items: 1343 n_users: 122958
sparsity: 0.07534786257884375
['/home/zgong/PDA/MF', '/home/zgong/.conda/envs/myenv/lib/python36.zip', '/home/zgong/.conda/envs/myenv/lib/python3.6', '/home/zgong/.conda/envs/myenv/lib/python3.6/lib-dynload', '/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages', '/home/zgong/PDA']
Evaluate model with cpp
half cores: 32
WARNING:tensorflow:From MF/train_new_api.py:936: The name tf.set_random_seed is deprecated. Please use tf.compat.v1.set_random_seed instead.

data size: 5.6e-05 GB
----- popularity_exp :  0.15
popularity used: ./data/netflix_movie/item_pop_seq_ori2.txt
pop save path:  ./data/netflix_movie/item_pop_seq_ori2.txt
pop_item_all shape: (1343, 10)
load pop information: 0.04887379247712932 1.0 0.0
-------    running PD & PDA model  ----------------
save_ID s_conditionpop_exp-0.15 (gamma)
------ popularity information --------
   each stage mean: [0.04225442 0.04297425 0.0376906  0.03648236 0.04082336 0.04162252
 0.05748009 0.06652936 0.05869731]
   each stage max: [1. 1. 1. 1. 1. 1. 1. 1. 1.]
   each stage min: [0. 0. 0. 0. 0. 0. 0. 0. 0.]
------ popularity information after powed  ------
   each stage mean: [0.20499799 0.24797012 0.29514973 0.31169746 0.37290878 0.42513256
 0.5135993  0.56587775 0.58186085]
   each stage max: [1. 1. 1. 1. 1. 1. 1. 1. 1.]
   each stage min: [0. 0. 0. 0. 0. 0. 0. 0. 0.]
WARNING:tensorflow:From MF/train_new_api.py:541: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

dataset api with pop or temp
WARNING:tensorflow:From /home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/data/ops/dataset_ops.py:494: py_func (from tensorflow.python.ops.script_ops) is deprecated and will be removed in a future version.
Instructions for updating:
tf.py_func is deprecated in TF V2. Instead, there are two
    options available in V2.
    - tf.py_function takes a python function which manipulates tf eager
    tensors instead of numpy arrays. It's easy to convert a tf eager tensor to
    an ndarray (just call tensor.numpy()) but having access to eager tensors
    means `tf.py_function`s can use accelerators such as GPUs as well as
    being differentiable using a gradient tape.
    - tf.numpy_function maintains the semantics of the deprecated tf.py_func
    (it is not differentiable, and manipulates numpy arrays). It drops the
    stateful argument making all functions stateful.
    
WARNING:tensorflow:From MF/train_new_api.py:566: The name tf.data.Iterator is deprecated. Please use tf.compat.v1.data.Iterator instead.

WARNING:tensorflow:From MF/train_new_api.py:566: DatasetV1.output_types (from tensorflow.python.data.ops.dataset_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.data.get_output_types(dataset)`.
WARNING:tensorflow:From MF/train_new_api.py:566: DatasetV1.output_shapes (from tensorflow.python.data.ops.dataset_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.data.get_output_shapes(dataset)`.
WARNING:tensorflow:From /home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/data/ops/iterator_ops.py:348: Iterator.output_types (from tensorflow.python.data.ops.iterator_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.data.get_output_types(iterator)`.
WARNING:tensorflow:From /home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/data/ops/iterator_ops.py:349: Iterator.output_shapes (from tensorflow.python.data.ops.iterator_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.data.get_output_shapes(iterator)`.
WARNING:tensorflow:From /home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/data/ops/iterator_ops.py:351: Iterator.output_classes (from tensorflow.python.data.ops.iterator_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.data.get_output_classes(iterator)`.
WARNING:tensorflow:
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

WARNING:tensorflow:From /home/zgong/PDA/MF/model_api.py:90: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /home/zgong/PDA/MF/model_api.py:130: The name tf.log is deprecated. Please use tf.math.log instead.

WARNING:tensorflow:From /home/zgong/PDA/MF/model_api.py:83: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

#params: 16033550
WARNING:tensorflow:From MF/train_new_api.py:595: The name tf.sparse.placeholder is deprecated. Please use tf.compat.v1.sparse.placeholder instead.

WARNING:tensorflow:From MF/train_new_api.py:1011: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

WARNING:tensorflow:From MF/train_new_api.py:1014: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

valid in valid set
args info: Namespace(Ks='[20]', alpha=0.001, base=-1.0, batch_size=2048, beta=0.001, c=10.0, cf_pen=1.0, check_c=1, check_epoch='all', cores=1, cuda='1', data_path='./data/', data_type='ori', dataset='netflix_movie', devide_ratio=0.8, early_stop=1, embed_size=64, end=10.0, epoch=1000, epochs='[]', exp_init_values=0.1, fregs=1e-05, imb_type='exp', lam=1.0, load_epoch=400, log_interval=5, lr=0.01, model='mf', model_type='o', need_save=1, out=0, pc_alpha=0.1, pc_beta=0.1, pop_exp=0.15, pop_used=-2, pop_wd=0.0, pretrain=0, regs=0.01, saveID='s_conditionpop_exp-0.15 (gamma)', save_dir='save_model/', save_flag=1, skew=0, source='normal', start=0.0, step=1, test='s_condition', top_ratio=0.1, train='s_condition', train_c='val', user_max=1000, user_min=1, valid_set='valid', verbose=1, wd=0.01)
top K: [20]
batch_num: 6076 waiting sampling...
sampled data finished
do not consider popularity (PD or PDG) ... 
Epoch 0 [588.3s]: train==[0.32478=0.24356 + 0.08122]
||---------------------------------------------- recall=[0.12868, 0.12868], precision=[0.14146, 0.14146], hit=[0.76917, 0.76917], ndcg=[0.17080, 0.17080]
injecting last stage popularity.... 
||------------PDA/PDGA injecting last stage popularity testing : time:  12
||---------------------------------------------- recall=[0.16590, 0.16590], precision=[0.17299, 0.17299], hit=[0.82434, 0.82434], ndcg=[0.21933, 0.21933]
||------------PDA/PDGA injecting linear predicted popularity testing : time:  12
||---------------------------------------------- recall=[0.17170, 0.17170], precision=[0.17276, 0.17276], hit=[0.83704, 0.83704], ndcg=[0.22379, 0.22379]
sampled data finished
Epoch 1 [597.9s]: train==[0.30408=0.19686 + 0.10722]
sampled data finished
Epoch 2 [568.5s]: train==[0.30170=0.19009 + 0.11161]
sampled data finished
Epoch 3 [592.2s]: train==[0.30020=0.18689 + 0.11330]
sampled data finished
Epoch 4 [600.1s]: train==[0.29875=0.18461 + 0.11415]
sampled data finished
do not consider popularity (PD or PDG) ... 
Epoch 5 [592.4s]: train==[0.29750=0.18294 + 0.11456]
||---------------------------------------------- recall=[0.13216, 0.13216], precision=[0.14652, 0.14652], hit=[0.77627, 0.77627], ndcg=[0.17640, 0.17640]
injecting last stage popularity.... 
||------------PDA/PDGA injecting last stage popularity testing : time:  12
||---------------------------------------------- recall=[0.16988, 0.16988], precision=[0.17731, 0.17731], hit=[0.82932, 0.82932], ndcg=[0.22229, 0.22229]
||------------PDA/PDGA injecting linear predicted popularity testing : time:  11
||---------------------------------------------- recall=[0.17705, 0.17705], precision=[0.17751, 0.17751], hit=[0.84479, 0.84479], ndcg=[0.22722, 0.22722]
sampled data finished
Epoch 6 [593.8s]: train==[0.29667=0.18188 + 0.11479]
sampled data finished
Epoch 7 [570.3s]: train==[0.29607=0.18106 + 0.11501]
sampled data finished
Epoch 8 [590.8s]: train==[0.29556=0.18049 + 0.11507]
sampled data finished
Epoch 9 [591.0s]: train==[0.29526=0.18008 + 0.11518]
sampled data finished
do not consider popularity (PD or PDG) ... 
Epoch 10 [588.7s]: train==[0.29489=0.17969 + 0.11520]
||---------------------------------------------- recall=[0.13955, 0.13955], precision=[0.15208, 0.15208], hit=[0.78919, 0.78919], ndcg=[0.18526, 0.18526]
injecting last stage popularity.... 
||------------PDA/PDGA injecting last stage popularity testing : time:  11
||---------------------------------------------- recall=[0.17394, 0.17394], precision=[0.18112, 0.18112], hit=[0.83494, 0.83494], ndcg=[0.23185, 0.23185]
||------------PDA/PDGA injecting linear predicted popularity testing : time:  12
||---------------------------------------------- recall=[0.18038, 0.18038], precision=[0.18150, 0.18150], hit=[0.84813, 0.84813], ndcg=[0.23760, 0.23760]
sampled data finished
Epoch 11 [587.4s]: train==[0.29480=0.17959 + 0.11521]
sampled data finished
Epoch 12 [569.3s]: train==[0.29446=0.17924 + 0.11523]
sampled data finished
Epoch 13 [592.0s]: train==[0.29434=0.17906 + 0.11528]
sampled data finished
Epoch 14 [588.1s]: train==[0.29433=0.17903 + 0.11530]
led data finished
do not consider popularity (PD or PDG) ... 
Epoch 15 [590.5s]: train==[0.29248=0.17538 + 0.11709]
||---------------------------------------------- recall=[0.15083, 0.15083], precision=[0.16112, 0.16112], hit=[0.80587, 0.80587], ndcg=[0.19911, 0.19911]
injecting last stage popularity.... 
||------------PDA/PDGA injecting last stage popularity testing : time:  9
||---------------------------------------------- recall=[0.17268, 0.17268], precision=[0.17949, 0.17949], hit=[0.83404, 0.83404], ndcg=[0.22942, 0.22942]
||------------PDA/PDGA injecting linear predicted popularity testing : time:  10
||---------------------------------------------- recall=[0.17807, 0.17807], precision=[0.18004, 0.18004], hit=[0.84566, 0.84566], ndcg=[0.23468, 0.23468]
sampled data finished
Epoch 16 [599.9s]: train==[0.29233=0.17521 + 0.11712]
sampled data finished
Epoch 17 [600.8s]: train==[0.29229=0.17519 + 0.11711]
