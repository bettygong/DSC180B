/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
*** Current working path ***
/home/zgong/PDA
time slot unique in train: [6 7 5 8 0 3 2 4 1]
                                                   uid                                               time
iid                                                                                                      
0    [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,...  [6, 7, 7, 6, 6, 5, 7, 6, 7, 6, 5, 7, 5, 6, 5, ...
1    [1270, 1271, 1272, 1273, 1274, 1275, 1276, 127...  [8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, ...
12442388 833866 1942172
n_items: 1343 n_users: 122958
sparsity: 0.07534786257884375
['/home/zgong/PDA/MF', '/home/zgong/.conda/envs/myenv/lib/python36.zip', '/home/zgong/.conda/envs/myenv/lib/python3.6', '/home/zgong/.conda/envs/myenv/lib/python3.6/lib-dynload', '/home/zgong/.conda/envs/myenv/lib/python3.6/site-packages', '/home/zgong/PDA']
Evaluate model with cpp
half cores: 40
WARNING:tensorflow:From MF/train_new_api.py:936: The name tf.set_random_seed is deprecated. Please use tf.compat.v1.set_random_seed instead.

data size: 5.6e-05 GB
----- popularity_exp :  0.15
popularity used: ./data/netflix_movie/item_pop_seq_ori2.txt
pop save path:  ./data/netflix_movie/item_pop_seq_ori2.txt
pop_item_all shape: (1343, 10)
load pop information: 0.04887379247712932 1.0 0.0
-------    running PD & PDA model  ----------------
save_ID s_conditionpop_exp-0.15 (gamma)
------ popularity information --------
   each stage mean: [0.04225442 0.04297425 0.0376906  0.03648236 0.04082336 0.04162252
 0.05748009 0.06652936 0.05869731]
   each stage max: [1. 1. 1. 1. 1. 1. 1. 1. 1.]
   each stage min: [0. 0. 0. 0. 0. 0. 0. 0. 0.]
------ popularity information after powed  ------
   each stage mean: [0.20499799 0.24797012 0.29514973 0.31169746 0.37290878 0.42513256
 0.5135993  0.56587775 0.58186085]
   each stage max: [1. 1. 1. 1. 1. 1. 1. 1. 1.]
   each stage min: [0. 0. 0. 0. 0. 0. 0. 0. 0.]
WARNING:tensorflow:From MF/train_new_api.py:541: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

dataset api with pop or temp
WARNING:tensorflow:From /home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/data/ops/dataset_ops.py:494: py_func (from tensorflow.python.ops.script_ops) is deprecated and will be removed in a future version.
Instructions for updating:
tf.py_func is deprecated in TF V2. Instead, there are two
    options available in V2.
    - tf.py_function takes a python function which manipulates tf eager
    tensors instead of numpy arrays. It's easy to convert a tf eager tensor to
    an ndarray (just call tensor.numpy()) but having access to eager tensors
    means `tf.py_function`s can use accelerators such as GPUs as well as
    being differentiable using a gradient tape.
    - tf.numpy_function maintains the semantics of the deprecated tf.py_func
    (it is not differentiable, and manipulates numpy arrays). It drops the
    stateful argument making all functions stateful.
    
WARNING:tensorflow:From MF/train_new_api.py:566: The name tf.data.Iterator is deprecated. Please use tf.compat.v1.data.Iterator instead.

WARNING:tensorflow:From MF/train_new_api.py:566: DatasetV1.output_types (from tensorflow.python.data.ops.dataset_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.data.get_output_types(dataset)`.
WARNING:tensorflow:From MF/train_new_api.py:566: DatasetV1.output_shapes (from tensorflow.python.data.ops.dataset_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.data.get_output_shapes(dataset)`.
WARNING:tensorflow:From /home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/data/ops/iterator_ops.py:348: Iterator.output_types (from tensorflow.python.data.ops.iterator_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.data.get_output_types(iterator)`.
WARNING:tensorflow:From /home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/data/ops/iterator_ops.py:349: Iterator.output_shapes (from tensorflow.python.data.ops.iterator_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.data.get_output_shapes(iterator)`.
WARNING:tensorflow:From /home/zgong/.conda/envs/myenv/lib/python3.6/site-packages/tensorflow/python/data/ops/iterator_ops.py:351: Iterator.output_classes (from tensorflow.python.data.ops.iterator_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.compat.v1.data.get_output_classes(iterator)`.
WARNING:tensorflow:
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

WARNING:tensorflow:From /home/zgong/PDA/MF/model_api.py:90: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /home/zgong/PDA/MF/model_api.py:130: The name tf.log is deprecated. Please use tf.math.log instead.

WARNING:tensorflow:From /home/zgong/PDA/MF/model_api.py:83: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

#params: 16033550
WARNING:tensorflow:From MF/train_new_api.py:595: The name tf.sparse.placeholder is deprecated. Please use tf.compat.v1.sparse.placeholder instead.

WARNING:tensorflow:From MF/train_new_api.py:1011: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

WARNING:tensorflow:From MF/train_new_api.py:1014: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

valid in valid set
args info: Namespace(Ks='[20]', alpha=0.001, base=-1.0, batch_size=2048, beta=0.001, c=10.0, cf_pen=1.0, check_c=1, check_epoch='all', cores=1, cuda='1', data_path='./data/', data_type='ori', dataset='netflix_movie', devide_ratio=0.8, early_stop=1, embed_size=64, end=10.0, epoch=1000, epochs='[]', exp_init_values=0.1, fregs=1e-05, imb_type='exp', lam=1.0, load_epoch=400, log_interval=5, lr=0.01, model='mf', model_type='o', need_save=1, out=0, pc_alpha=0.1, pc_beta=0.1, pop_exp=0.15, pop_used=-2, pop_wd=0.0, pretrain=0, regs=0.01, saveID='s_conditionpop_exp-0.15 (gamma)', save_dir='home/zgong/private/PDA/save_model/', save_flag=1, skew=0, source='normal', start=0.0, step=1, test='s_condition', top_ratio=0.1, train='s_condition', train_c='val', user_max=1000, user_min=1, valid_set='valid', verbose=1, wd=0.01)
top K: [20]
batch_num: 6076 waiting sampling...
sampled data finished
do not consider popularity (PD or PDG) ... 
Epoch 0 [353.3s]: train==[0.32482=0.24359 + 0.08123]
||---------------------------------------------- recall=[0.12476, 0.12476], precision=[0.13837, 0.13837], hit=[0.76722, 0.76722], ndcg=[0.16854, 0.16854]
injecting last stage popularity.... 
||------------PDA/PDGA injecting last stage popularity testing : time:  4
||---------------------------------------------- recall=[0.16162, 0.16162], precision=[0.17026, 0.17026], hit=[0.82153, 0.82153], ndcg=[0.21739, 0.21739]
||------------PDA/PDGA injecting linear predicted popularity testing : time:  6
||---------------------------------------------- recall=[0.16720, 0.16720], precision=[0.16961, 0.16961], hit=[0.83253, 0.83253], ndcg=[0.22240, 0.22240]
sampled data finished
Epoch 1 [359.8s]: train==[0.30425=0.19702 + 0.10723]
sampled data finished
Epoch 2 [340.4s]: train==[0.30214=0.19038 + 0.11175]
sampled data finished
Epoch 3 [339.7s]: train==[0.30071=0.18734 + 0.11337]
sampled data finished
Epoch 4 [344.2s]: train==[0.29943=0.18520 + 0.11423]
sampled data finished
do not consider popularity (PD or PDG) ... 
Epoch 5 [356.3s]: train==[0.29850=0.18371 + 0.11479]
||---------------------------------------------- recall=[0.12906, 0.12906], precision=[0.14514, 0.14514], hit=[0.76759, 0.76759], ndcg=[0.17468, 0.17468]
injecting last stage popularity.... 
||------------PDA/PDGA injecting last stage popularity testing : time:  5
||---------------------------------------------- recall=[0.16524, 0.16524], precision=[0.17545, 0.17545], hit=[0.82166, 0.82166], ndcg=[0.21941, 0.21941]
||------------PDA/PDGA injecting linear predicted popularity testing : time:  4
||---------------------------------------------- recall=[0.17276, 0.17276], precision=[0.17631, 0.17631], hit=[0.83744, 0.83744], ndcg=[0.22435, 0.22435]
sampled data finished
Epoch 6 [347.8s]: train==[0.29774=0.18272 + 0.11501]
